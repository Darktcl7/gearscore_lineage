{% extends 'items/base.html' %}
{% load static %}

{% block title %}My Activity{% endblock %}

{% block extra_body_attributes %}class="fullscreen-page"{% endblock %}

{% block extra_head %}
<style>
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background: #0c0c0c;
    }

    #site-content {
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    main {
        flex: 1;
        overflow: hidden;
    }

    .activity-container {
        height: calc(100% - 90px);
        margin-top: 80px;
        display: flex;
        flex-direction: column;
        background: rgba(18, 18, 18, 0.85);
        border-radius: 20px;
        box-shadow: 0 10px 35px rgba(0, 0, 0, 0.7);
        overflow: hidden;
        position: relative;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        margin-left: 10px;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    .activity-header {
        padding: 25px;
        background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
    }

    .activity-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, #3498db, #2ecc71, #3498db);
        background-size: 200% 200%;
        animation: gradientShift 3s ease infinite;
    }

    @keyframes gradientShift {
        0% {
            background-position: 0% 50%;
        }

        50% {
            background-position: 100% 50%;
        }

        100% {
            background-position: 0% 50%;
        }
    }

    .activity-header h1 {
        margin: 0;
        color: #ffffff;
        font-size: 1.8rem;
    }

    .activity-content {
        flex: 1;
        display: flex;
        gap: 20px;
        padding: 25px;
        overflow-y: auto;
    }

    .stats-section {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .history-section {
        flex: 2;
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .glass-card h3 {
        margin: 0 0 15px 0;
        color: #DAA520;
        font-size: 1.1rem;
    }

    .stat-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
    }

    .stat-item {
        text-align: center;
        padding: 20px;
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
    }

    .stat-value {
        font-size: 2rem;
        font-weight: 700;
        color: #DAA520;
    }

    .stat-label {
        font-size: 0.85rem;
        color: #888;
        margin-top: 5px;
    }

    .tier-badge {
        display: inline-block;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 1.2rem;
        font-weight: 600;
        margin-top: 15px;
    }

    .tier-elite {
        background: linear-gradient(145deg, #FFD700, #FFA500);
        color: #000;
    }

    .tier-core {
        background: linear-gradient(145deg, #9B59B6, #8E44AD);
        color: #fff;
    }

    .tier-active {
        background: linear-gradient(145deg, #3498DB, #2980B9);
        color: #fff;
    }

    .tier-casual {
        background: linear-gradient(145deg, #7F8C8D, #6C7A7D);
        color: #fff;
    }

    .activity-table {
        width: 100%;
        border-collapse: collapse;
    }

    .activity-table th,
    .activity-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .activity-table th {
        background: rgba(255, 255, 255, 0.1);
        color: #DAA520;
    }

    .activity-table tr:hover {
        background: rgba(255, 255, 255, 0.05);
    }

    .status-attended {
        color: #2ecc71;
    }

    .status-absent {
        color: #e74c3c;
    }

    .event-type-badge {
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .event-invasion {
        background: #e74c3c;
    }

    .event-boss_rush {
        background: #9b59b6;
    }

    .event-catacombs {
        background: #3498db;
    }

    .no-character {
        text-align: center;
        padding: 60px;
    }

    .no-character i {
        font-size: 4rem;
        color: #DAA520;
        opacity: 0.5;
        margin-bottom: 20px;
    }

    .btn-primary {
        display: inline-block;
        padding: 12px 25px;
        background: linear-gradient(145deg, #DAA520, #B8860B);
        color: #000;
        text-decoration: none;
        border-radius: 8px;
        font-weight: 600;
        margin-top: 15px;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(218, 165, 32, 0.4);
    }
</style>
{% endblock %}

{% block content %}
<div class="activity-container">
    <div class="activity-header">
        <h1><i class="fas fa-chart-line"></i> My Activity</h1>
    </div>

    {% if no_character %}
    <div class="activity-content">
        <div class="no-character" style="width: 100%;">
            <i class="fas fa-user-slash"></i>
            <h2>No Character Found</h2>
            <p style="color: #888;">You need to create a character first to track your activity.</p>
            <a href="{% url 'create-character' %}" class="btn-primary">
                <i class="fas fa-plus"></i> Create Character
            </a>
        </div>
    </div>
    {% else %}
    <div class="activity-content">
        <!-- Stats Section -->
        <div class="stats-section">
            <div class="glass-card">
                <h3><i class="fas fa-user"></i> {{ character.name }}</h3>
                <div style="text-align: center;">
                    {% if monthly_report %}
                    <div class="tier-badge tier-{{ monthly_report.tier|lower }}">
                        {{ monthly_report.get_tier_display }}
                    </div>
                    {% else %}
                    <div class="tier-badge tier-casual">ðŸŒ± Casual</div>
                    {% endif %}
                </div>
            </div>

            <div class="glass-card">
                <h3><i class="fas fa-chart-bar"></i> Monthly Stats</h3>
                <div class="stat-grid">
                    <div class="stat-item">
                        <div class="stat-value">{{ monthly_report.total_score|default:0 }}</div>
                        <div class="stat-label">Current Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ attendance_rate|floatformat:0 }}%</div>
                        <div class="stat-label">Attendance</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ attended_count }}</div>
                        <div class="stat-label">Events Joined</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">{{ total_events }}</div>
                        <div class="stat-label">Total Events</div>
                    </div>
                </div>
            </div>

            <a href="{% url 'activity-leaderboard' %}" class="glass-card"
                style="text-decoration: none; display: block; text-align: center;">
                <i class="fas fa-trophy" style="font-size: 2rem; color: #DAA520;"></i>
                <p style="margin: 10px 0 0 0; color: #fff;">View Leaderboard</p>
            </a>
        </div>

        <!-- Activity History -->
        <div class="history-section">
            <div class="glass-card" style="height: 100%;">
                <h3><i class="fas fa-history"></i> Activity History (Last 30 Days)</h3>

                {% if activities %}
                <table class="activity-table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Event</th>
                            <th>Status</th>
                            <th>Points</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for activity in activities %}
                        <tr>
                            <td>{{ activity.event.date|date:"M d, H:i" }}</td>
                            <td>
                                <span class="event-type-badge event-{{ activity.event.event_type|lower }}">
                                    {{ activity.event.get_event_type_display }}
                                </span>
                            </td>
                            <td>
                                {% if activity.status == 'ATTENDED' %}
                                <span class="status-attended"><i class="fas fa-check-circle"></i> Attended</span>
                                {% else %}
                                <span class="status-absent"><i class="fas fa-times-circle"></i> Absent</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if activity.points_earned > 0 %}
                                <strong style="color: #2ecc71;">+{{ activity.points_earned }}</strong>
                                {% else %}
                                <span style="color: #888;">0</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <div style="text-align: center; padding: 40px; color: #888;">
                    <i class="fas fa-calendar-times" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                    <p>No activity records found.</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}